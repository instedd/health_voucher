%h1 Reports

= render partial: 'shared/reports_tabs'

%h2 AGEP IDs per site

.tablewrapp
  %table.GralTable.report-table
    %colgroup
    %tbody
      %tr
        %th Site
        %th.number Total AGEP IDs
        %th.number without card
        %th.number with assigned card
        %th.number used in the last 7 days
      - if @data.empty?
        %tr
          %td(colspan="5") No sites registered.
      - else
        %tr.totals
          %td
          %td.number
            = @totals[:patient_count]
            %span.percentage 100.00%
          %td.number
            = @totals[:patients_without_card]
            %span.percentage
              = percent_of_with_base(@totals[:patients_without_card], @totals[:patient_count])
          %td.number
            = @totals[:patients_with_card]
            %span.percentage
              = percent_of_with_base(@totals[:patients_with_card], @totals[:patient_count])
          %td.number
            = @totals[:patients_with_recent_card_uses]
            %span.percentage
              = percent_of_with_base(@totals[:patients_with_recent_card_uses], @totals[:patients_with_card])

        - @data.each do |row|
          %tr
            %td= row[:name]
            %td.number
              = row[:patient_count]
              %span.percentage
                = percent_of_with_base(row, @totals, :patient_count)
            %td.number
              = row[:patients_without_card]
              %span.percentage
                = percent_of_with_base(row[:patients_without_card], row[:patient_count])
            %td.number
              = row[:patients_with_card]
              %span.percentage
                = percent_of_with_base(row[:patients_with_card], row[:patient_count])
            %td.number
              = row[:patients_with_recent_card_uses]
              %span.percentage
                = percent_of_with_base(row[:patients_with_recent_card_uses], row[:patients_with_card])

